<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Order Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a cleaner look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Lighter gray background */
        }
        .status-badge {
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }
        /* Specific status colors - slightly richer palette */
        .status-PENDING { background-color: #fffbeb; color: #b45309; border: 1px solid #fcd34d; }
        .status-CONFIRMED { background-color: #f0fdf4; color: #15803d; border: 1px solid #4ade80; }
        .status-SHIPPED { background-color: #eff6ff; color: #2563eb; border: 1px solid #60a5fa; }
        .status-OUT_FOR_DELIVERY { background-color: #f0f9ff; color: #0891b2; border: 1px solid #67e8f9; }
        .status-DELIVERED { background-color: #d1fae5; color: #065f46; border: 1px solid #34d399; }
        .status-CANCELLED { background-color: #fff1f2; color: #be123c; border: 1px solid #fca5a5; }

        /* Hide the modal by default */
        .modal {
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            pointer-events: none;
        }
        .modal.show {
            opacity: 1;
            pointer-events: auto;
        }
        /* Custom Table Styling for Stripes and hover */
        .order-row:nth-child(even) {
            background-color: #f9fafb;
        }
        .order-row:hover {
            background-color: #f3f4f6 !important;
            transition: background-color 0.15s ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-lg sticky top-0 z-10">
        <div class="max-w-7xl mx-auto py-5 px-4 sm:px-6 lg:px-8 flex justify-between items-center">
            <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight">
                <span class="text-indigo-600">Order</span> Dashboard
            </h1>
            <div class="flex items-center space-x-2 text-sm text-gray-500 bg-gray-100 py-2 px-4 rounded-full">
                <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                <span class="font-semibold text-gray-800">Admin Panel</span>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto py-10 sm:px-6 lg:px-8">
        
        <!-- KPI Cards Section -->
        <div id="kpiContainer" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Cards will be rendered here by JavaScript -->
        </div>

        <div class="bg-white rounded-2xl shadow-2xl overflow-hidden ring-1 ring-gray-200">
            <div class="p-4 sm:p-6 lg:p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-9-4h9m6 0h9"></path></svg>
                    Order Management Table
                </h2>

                <!-- Order List Table -->
                <div class="overflow-x-auto">
                    <table id="orderTable" class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-indigo-50/50">
                            <tr>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tl-xl">
                                    ID
                                </th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    Customer
                                </th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider hidden sm:table-cell">
                                    Total
                                </th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider hidden md:table-cell">
                                    Order Date
                                </th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">
                                    Status
                                </th>
                                <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider rounded-tr-xl">
                                    Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody id="ordersBody" class="bg-white divide-y divide-gray-100">
                            <!-- Orders will be injected here by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Message Box for UI feedback -->
                <div id="messageBox" class="mt-6 p-4 rounded-lg text-sm text-white shadow-md bg-indigo-600 hidden transition-all duration-300 ease-in-out"></div>
            </div>
        </div>
    </main>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal fixed inset-0 bg-gray-900 bg-opacity-50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-3xl max-w-lg w-full p-8 transition-all transform scale-100 border-t-4 border-indigo-500">
            <h3 class="text-2xl font-extrabold text-gray-900 mb-2" id="modalTitle">Confirm Status Update</h3>
            <p class="text-sm text-gray-500 mb-6">This action will update the order status for the customer and cannot be easily reverted.</p>
            <p class="text-gray-700 mb-6">Are you sure you want to change the status of order <span id="modalOrderId" class="font-bold text-indigo-600"></span> to <span id="modalNewStatusText" class="font-bold"></span>?</p>
            <div class="flex justify-end space-x-3 pt-4">
                <button onclick="closeModal()" class="py-2 px-5 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-100 transition shadow-sm">
                    Cancel
                </button>
                <button id="modalConfirmButton" onclick="performStatusUpdate()" class="py-2 px-5 rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 transition font-semibold shadow-md hover:shadow-lg">
                    Confirm Change
                </button>
            </div>
        </div>
    </div>


    <script>
        // Use a unique App ID for Firebase/API configuration (Placeholder since we are simulating)
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-order-app';
        const apiKey = ""; // API key for Gemini calls (not used in this simulation)
        
        // --- Order Data (Simulated Django Queryset) ---
        let orders = [
            { id: 1001, customer: 'Alice Johnson', total: 49.99, date: '2023-11-01', status: 'PENDING' },
            { id: 1002, customer: 'Bob Smith', total: 125.50, date: '2023-11-02', status: 'CONFIRMED' },
            { id: 1003, customer: 'Charlie Brown', total: 15.00, date: '2023-11-03', status: 'SHIPPED' },
            { id: 1004, customer: 'Diana Prince', total: 350.99, date: '2023-11-04', status: 'OUT_FOR_DELIVERY' },
            { id: 1005, customer: 'Ethan Hunt', total: 9.99, date: '2023-11-05', status: 'DELIVERED' },
            { id: 1006, customer: 'Fiona Glenn', total: 88.00, date: '2023-11-06', status: 'PENDING' },
            { id: 1007, customer: 'George Lucas', total: 55.75, date: '2023-11-07', status: 'CANCELLED' },
            { id: 1008, customer: 'Hannah Abbot', total: 29.50, date: '2023-11-07', status: 'PENDING' },
            { id: 1009, customer: 'Ian Malcolm', total: 75.00, date: '2023-11-08', status: 'CONFIRMED' },
            { id: 1010, customer: 'Julia Roberts', total: 199.99, date: '2023-11-08', status: 'OUT_FOR_DELIVERY' },
        ];

        // --- Status Definitions ---
        const STATUS_STEPS = {
            'PENDING': ['CONFIRMED', 'CANCELLED'],
            'CONFIRMED': ['SHIPPED', 'CANCELLED'],
            'SHIPPED': ['OUT_FOR_DELIVERY', 'CANCELLED'],
            'OUT_FOR_DELIVERY': ['DELIVERED', 'CANCELLED'],
            'DELIVERED': [], // Final state
            'CANCELLED': [], // Final state
        };

        const STATUS_MAPPING = {
            'PENDING': 'Pending Review',
            'CONFIRMED': 'Confirmed & Processing',
            'SHIPPED': 'Shipped',
            'OUT_FOR_DELIVERY': 'Out for Delivery',
            'DELIVERED': 'Delivered',
            'CANCELLED': 'Cancelled',
        };

        // --- Utility Functions for Icons ---
        function getIconSvg(iconName) {
            switch(iconName) {
                case 'PENDING': return '<svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                case 'SHIPPED': return '<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4m-4 4l-4 4m-4-4l-4-4m4 4v4m0-12V4"></path></svg>';
                case 'DELIVERED': return '<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                default: return '<svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"></path></svg>';
            }
        }

        // --- UI Rendering Functions ---

        /**
         * Generates the HTML for the status badge.
         * @param {string} statusKey - The status key (e.g., 'PENDING').
         * @returns {string} HTML string.
         */
        function getStatusBadgeHtml(statusKey) {
            const statusText = STATUS_MAPPING[statusKey];
            return `<span class="status-badge status-${statusKey}">${statusText}</span>`;
        }

        /**
         * Generates the HTML for the action buttons based on the current status.
         * @param {number} orderId - The ID of the order.
         * @param {string} currentStatus - The current status key.
         * @returns {string} HTML string for buttons.
         */
        function getActionButtonsHtml(orderId, currentStatus) {
            const nextStatuses = STATUS_STEPS[currentStatus];
            if (!nextStatuses || nextStatuses.length === 0) {
                return '<span class="text-sm text-gray-500 italic">Finalized</span>';
            }

            return nextStatuses.map(newStatus => {
                const isDestructive = newStatus === 'CANCELLED';
                const buttonClass = isDestructive
                    ? 'bg-red-500 hover:bg-red-600 shadow-md'
                    : 'bg-indigo-600 hover:bg-indigo-700 shadow-md';
                const buttonText = STATUS_MAPPING[newStatus].split(' ')[0]; // Use first word for brevity

                return `
                    <button
                        onclick="openModal(${orderId}, '${newStatus}')"
                        class="text-white text-xs font-semibold py-1.5 px-3 rounded-lg transition transform hover:scale-105 ${buttonClass} disabled:opacity-50 disabled:hover:scale-100"
                        title="Change status to ${STATUS_MAPPING[newStatus]}"
                    >
                        ${buttonText}
                    </button>
                `;
            }).join(' ');
        }

        /**
         * Calculates and renders the Key Performance Indicator (KPI) cards.
         */
        function renderKPIs() {
            const totalOrders = orders.length;
            const totalPending = orders.filter(o => o.status === 'PENDING').length;
            const totalShipped = orders.filter(o => o.status === 'SHIPPED' || o.status === 'OUT_FOR_DELIVERY').length;
            const totalDelivered = orders.filter(o => o.status === 'DELIVERED').length;

            const kpis = [
                { title: 'Total Pending', value: totalPending, color: 'yellow', icon: 'PENDING' },
                { title: 'Total Shipped', value: totalShipped, color: 'blue', icon: 'SHIPPED' },
                { title: 'Total Delivered', value: totalDelivered, color: 'green', icon: 'DELIVERED' },
            ];

            const container = document.getElementById('kpiContainer');
            container.innerHTML = kpis.map(kpi => `
                <div class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-${kpi.color}-500 transition-all duration-300 hover:shadow-2xl hover:scale-[1.01]">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-500">${kpi.title}</p>
                            <p class="text-3xl font-extrabold text-gray-900 mt-1">${kpi.value}</p>
                        </div>
                        <div class="p-3 bg-${kpi.color}-100 rounded-full">
                            ${getIconSvg(kpi.icon)}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        /**
         * Renders all orders into the table body.
         */
        function renderOrders() {
            const ordersBody = document.getElementById('ordersBody');
            ordersBody.innerHTML = ''; // Clear existing rows

            orders.forEach(order => {
                const row = ordersBody.insertRow();
                row.className = 'order-row'; // Custom class for stripe/hover styling

                // ID
                row.insertCell().innerHTML = `<span class="font-mono text-sm font-bold text-indigo-700">#${order.id}</span>`;
                row.cells[0].className = 'px-4 py-3 whitespace-nowrap';

                // Customer
                row.insertCell().innerHTML = `<div class="text-sm font-semibold text-gray-900">${order.customer}</div>`;
                row.cells[1].className = 'px-4 py-3 whitespace-nowrap';

                // Total (Hidden on small screens)
                row.insertCell().innerHTML = `<div class="text-sm font-medium text-gray-700 hidden sm:table-cell">$${order.total.toFixed(2)}</div>`;
                row.cells[2].className = 'px-4 py-3 whitespace-nowrap text-right hidden sm:table-cell';

                // Date (Hidden on tablet/desktop)
                row.insertCell().innerHTML = `<div class="text-xs text-gray-500 hidden md:table-cell">${order.date}</div>`;
                row.cells[3].className = 'px-4 py-3 whitespace-nowrap hidden md:table-cell';

                // Status
                row.insertCell().innerHTML = getStatusBadgeHtml(order.status);
                row.cells[4].className = 'px-4 py-3 whitespace-nowrap';

                // Actions
                row.insertCell().innerHTML = getActionButtonsHtml(order.id, order.status);
                row.cells[5].className = 'px-4 py-3 whitespace-nowrap text-right';
            });
            
            // Also update the KPIs when orders are rendered
            renderKPIs();
        }

        // --- Modal and State Management ---

        let currentOrderToUpdate = null;
        let newStatusKey = null;

        /**
         * Opens the confirmation modal.
         * @param {number} orderId - The ID of the order being changed.
         * @param {string} newStatus - The target status key.
         */
        function openModal(orderId, newStatus) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;

            currentOrderToUpdate = order;
            newStatusKey = newStatus;

            const newStatusText = STATUS_MAPPING[newStatus];

            document.getElementById('modalOrderId').textContent = `#${orderId}`;
            document.getElementById('modalNewStatusText').textContent = newStatusText;
            
            // Set button color based on action type
            const confirmButton = document.getElementById('modalConfirmButton');
            confirmButton.classList.remove('bg-red-600', 'hover:bg-red-700', 'bg-indigo-600', 'hover:bg-indigo-700');
            
            if (newStatus === 'CANCELLED') {
                confirmButton.classList.add('bg-red-600', 'hover:bg-red-700');
                confirmButton.textContent = 'Confirm Cancellation';
            } else {
                confirmButton.classList.add('bg-indigo-600', 'hover:bg-indigo-700');
                confirmButton.textContent = `Confirm ${newStatusText.split(' ')[0]}`;
            }

            document.getElementById('confirmationModal').classList.add('show');
        }

        /**
         * Closes the confirmation modal.
         */
        function closeModal() {
            document.getElementById('confirmationModal').classList.remove('show');
            currentOrderToUpdate = null;
            newStatusKey = null;
        }

        /**
         * Displays a temporary success or error message.
         * @param {string} message - The message text.
         * @param {boolean} isError - If true, displays an error style.
         */
        function showMessage(message, isError = false) {
            const box = document.getElementById('messageBox');
            box.textContent = message;
            
            // Reset and apply new styles
            box.classList.remove('hidden', 'bg-indigo-600', 'bg-red-600');
            box.classList.add(isError ? 'bg-red-600' : 'bg-indigo-600');
            
            setTimeout(() => {
                box.classList.add('hidden');
            }, 4000);
        }

        /**
         * Simulates the actual status update (in a real Django app, this would be an AJAX call).
         */
        function performStatusUpdate() {
            if (!currentOrderToUpdate || !newStatusKey) {
                closeModal();
                return;
            }

            // --- SIMULATION START ---
            // Simulating a successful update
            const orderIndex = orders.findIndex(o => o.id === currentOrderToUpdate.id);
            if (orderIndex !== -1) {
                // Update the local data model
                orders[orderIndex].status = newStatusKey;
                
                // Re-render the UI and KPIs to show the change
                renderOrders(); 
                
                const statusText = STATUS_MAPPING[newStatusKey];
                showMessage(`✅ Successfully updated Order #${currentOrderToUpdate.id} to '${statusText}'.`, false);
            } else {
                showMessage(`❌ Error: Could not find order ID ${currentOrderToUpdate.id}.`, true);
            }
            // --- SIMULATION END ---

            closeModal();
        }

        // Initial render on load
        window.onload = renderOrders;

    </script>

</body>
</html>